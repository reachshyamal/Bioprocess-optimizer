##In depth for 100L##
d1 <- as.data.frame(read_excel("Master_data_upstream_29082017.xlsx",sheet=1))
d100<-subset(d1,d1$Scale=='100')
colnames(d100)
d100<-d100[,c(1:3,23,29,48,144,112,99,155,187,190,198,195)]
#d100<-na.omit(d100)
rsm24<-rsm(Yield~FO(averagepHbeforetemp.shift,AverageDO2)+TWI(averagepHbeforetemp.shift,AverageDO2),data=d100)
summary(rsm24)
rsm25<-rsm(Yield~FO(SeedtransferVCC100L,Max.IVCC100Lproduction)+TWI(SeedtransferVCC100L,Max.IVCC100Lproduction),data=d100)
summary(rsm25)
rsm26<-rsm(Yield~SO(Temp.shiftloghour),data=d100)
summary(rsm26)
rsm26a<-rsm(Yield~FO(Avg.osmo100L,Dextroselevel100)+TWI(Avg.osmo100L,Dextroselevel100),data=d100)
summary(rsm26a)

rsm1<-rsm(CultureSupernatant~FO(averagepHbeforetemp.shift,AverageDO2)+TWI(averagepHbeforetemp.shift,AverageDO2)+PQ(averagepHbeforetemp.shift),data=d100)
summary(rsm1)
rsm2<-rsm(CultureSupernatant~FO(SeedtransferVCC100L,Max.IVCC100Lproduction)+PQ(SeedtransferVCC100L,Max.IVCC100Lproduction),data=d100)
summary(rsm2)
rsm3<-lm(CultureSupernatant~Temp.shiftloghour-1,data=d100)
summary(rsm3)
rsm4<-rsm(CultureSupernatant~FO(Avg.osmo100L,Dextroselevel100)+TWI(Avg.osmo100L,Dextroselevel100)+PQ(Dextroselevel100),data=d100)
summary(rsm4)

d1 <- as.data.frame(read_excel("Master_data_upstream_29082017.xlsx",sheet=1))
d100<-subset(d1,d1$Scale=='100')
colnames(d100)
d10<-d100[,c(1:3,35,42,142,152,144)]
colnames(d10)
rsm27<-rsm(SeedtransferVCC100L~SO(SeedtransferVCC10L,Max.IVCC10Lseed),data=d10)
summary(rsm27)
##Media parameters##
d1 <- as.data.frame(read_excel("Master_data_upstream_29082017.xlsx",sheet=1))
d100<-subset(d1,d1$Scale=='100')
d100media<-d100[,c(1:3,26,83,115,187,195)]
colnames(d100media)
rsm28<-rsm(Yield~SO(Mediaosmolalityproduction,mediaholdpH100L),data=d100media)
summary(rsm28)

rsm5<-lm(CultureSupernatant~Mediaosmolalityproduction+mediaholdpH100L-1,data=d100media)
summary(rsm5)
##Inoc parameters##
d1 <- as.data.frame(read_excel("Master_data_upstream_29082017.xlsx",sheet=1))
d100<-subset(d1,d1$Scale=='100')
colnames(d100)
dinoc<-d100[,c(1:9,145)]
colnames(dinoc)
rsm29<-rsm(InoculumendVCC~SO(Vialviablecellcount,EndVCCsubculture3),data=dinoc)
summary(rsm29)
##For optimizing rate of change of VCC w.r.t.VCC and IVCC##
drate<-as.data.frame(read_excel("Upstream VCC.xlsx",sheet=1))
drate100<-subset(drate,drate$Batch.Capacity=='100')
drate100<-na.omit(drate100)
rsm30<-rsm(dVCC/dt~SO(VCC),data=drate100)
pred<-predict(rsm30,newdata=drate100)
summary(rsm30)
#contour(rsm30~VCC,image=TRUE,at = summary(rsm30)$canonical$xs)
drate10to100<-subset(drate,drate$Train=='10->100')
drate10to100<-na.omit(drate10to100)
rsm32<-rsm(dVCC/dt~SO(VCC),data=drate10to100)
summary(rsm32)
steepest(rsm32)
write.csv(rsm24$coefficients,"coefficients1.csv")
write.csv(rsm25$coefficients,"coefficients2.csv")
write.csv(rsm26$coefficients,"coefficients3.csv")
write.csv(rsm26a$coefficients,"coefficients4.csv")
write.csv(rsm27$coefficients,"coefficients5.csv")
write.csv(rsm28$coefficients,"coefficients6.csv")
write.csv(rsm29$coefficients,"coefficients7.csv")
write.csv(rsm30$coefficients,"coefficients8.csv")
write.csv(rsm32$coefficients,"coefficients9.csv")

##Filtered supernatant with culture supernatant##
colnames(d1000)
d1000<-subset(d1,d1$Scale=='1000')
d1000FS<-d1000[,c(194,195)]
plot(d1000FS$CultureSupernatant,d1000FS$`Filtered Supernatant`,type='p')
lm37<-lm(CultureSupernatant~`Filtered Supernatant`-1,data=d1000FS)
summary(lm37)
abline(0,lm37$coefficients)
plot(lm37$fitted.values,type='b')
matplot(cbind(d1000FS$CultureSupernatant,lm37$fitted.values),type='l')
lines(lm37$coefficients*d1000FS$CultureSupernatant,type="p")

##Writing culture supernatant coefficients in a file##
write.csv(rsm33$coefficients,"coefficients_CS1.csv")
write.csv(rsm34$coefficients,"coefficients_CS2.csv")
write.csv(rsm35$coefficients,"coefficients_CS3.csv")
write.csv(rsm36$coefficients,"coefficients_CS4.csv")
write.csv(lm37$coefficients,"coefficients_FS1.csv")
